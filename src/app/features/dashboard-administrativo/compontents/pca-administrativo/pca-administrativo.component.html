<div class="mt-3">
  <div class="d-flex justify-content-between align-items-center mb-3 flex-wrap">
    <div>
      <h5>Planos de Contratações Anual</h5>
      <small>Lista de planos de contratações cadastrados</small>
    </div>
    <button
      [relativeTo]="route.parent"
      routerLink="cadastrar-pca"
      class="btn btn-adm-adicionar ms-2"
    >
      <mat-icon>add</mat-icon> Adicionar contrato
    </button>
  </div>

  <div class="container-fluid">
    <div class="filtro-row mb-4">
      <form
        [formGroup]="filterForm"
        (ngSubmit)="applyFilter()"
        class="d-flex flex-wrap align-items-end gap-3"
      >
        <div class="flex-grow-1">
          <label for="processo" class="form-label"
            >N° da compra ou PROCESSO</label
          >
          <input
            id="processo"
            type="text"
            class="form-control"
            formControlName="processo"
          />
        </div>

        <div class="flex-grow-1" style="max-width: 120px">
          <label for="ano" class="form-label">Ano</label>
          <input
            id="ano"
            type="text"
            class="form-control"
            formControlName="ano"
          />
        </div>

        <div class="flex-grow-1">
          <label for="modalidade" class="form-label">Modalidade</label>
          <select
            id="modalidade"
            class="form-control"
            formControlName="modalidade"
          >
            <option value="" disabled selected>Selecione a modalidade</option>
            <option value="modalidade1">Modalidade 1</option>
            <option value="modalidade2">Modalidade 2</option>
            <option value="modalidade3">Modalidade 3</option>
          </select>
        </div>

        <div class="flex-grow-1">
          <label for="orgao" class="form-label">Órgão</label>
          <select id="orgao" class="form-control" formControlName="orgao">
            <option value="" disabled selected>Selecione o órgão</option>
            <option value="orgao1">Órgão 1</option>
            <option value="orgao2">Órgão 2</option>
            <option value="orgao3">Órgão 3</option>
          </select>
        </div>

        <div>
          <button type="submit" class="btn btn-primary">Filtrar</button>
        </div>
      </form>
    </div>
  </div>

  <div *ngIf="isLoading" class="text-center my-4">
    <div class="spinner-border" role="status">
      <span class="visually-hidden">Carregando...</span>
    </div>
  </div>

  <div class="table-responsive" *ngIf="!isLoading">
    <table class="table-editada table-bordered mb-0">
      <thead>
        <tr>
          <th>Nº seq</th>
          <th>Órgão</th>
          <th>Unidade</th>
          <th>Ano</th>
          <th>Criado em</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let element of dataSource.data; let i = index">
          <td>{{ i + 1 }}</td>
          <td>{{ element.agency_country_register }}</td>
          <td>{{ element.unit_id }}</td>
          <td>{{ element.year }}</td>
          <td>
            {{
              element.created_at
                ? (element.created_at | date : "dd/MM/yyyy")
                : "-"
            }}
          </td>
          <td>
            <div class="d-flex justify-content-center">
              <button
                class="me-2 btn-edit btn-format mt-0 d-flex justify-content-center align-items-center"
                (click)="editContractPlan(element.id || '')"
              >
                <svg
                  viewBox="0 0 24 24"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <g id="Edit / Edit_Pencil_01">
                    <path
                      id="Vector"
                      d="M12 8.00012L4 16.0001V20.0001L8 20.0001L16 12.0001M12 8.00012L14.8686 5.13146L14.8704 5.12976C15.2652 4.73488 15.463 4.53709 15.691 4.46301C15.8919 4.39775 16.1082 4.39775 16.3091 4.46301C16.5369 4.53704 16.7345 4.7346 17.1288 5.12892L18.8686 6.86872C19.2646 7.26474 19.4627 7.46284 19.5369 7.69117C19.6022 7.89201 19.6021 8.10835 19.5369 8.3092C19.4628 8.53736 19.265 8.73516 18.8695 9.13061L18.8686 9.13146L16 12.0001M12 8.00012L16 12.0001"
                      stroke="#000000"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </g>
                </svg>
              </button>
              <button
                class="btn btn-sm btn-format btn-remove"
                (click)="deleteContractPlan(element.id || '')"
              >
                <img
                  src="../../../../../assets/icons/remove-icon.svg"
                  alt="Remover"
                />
              </button>
            </div>
          </td>
        </tr>
        <tr *ngIf="dataSource.data.length === 0">
          <td colspan="6" class="text-center">
            Nenhum plano de contrato encontrado
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="bkg-bottom d-flex justify-content-end align-items-center">
    <span class="resultado me-3">{{ dataSource.data.length }} resultados</span>
    <nav aria-label="Page navigation">
      <ul class="pagination">
        <li class="page-item" [class.disabled]="currentPage === 1">
          <a class="page-link" (click)="goToPage(1)" aria-label="Primeira">
            <span aria-hidden="true">&laquo;&laquo;</span>
          </a>
        </li>
        <li class="page-item" [class.disabled]="currentPage === 1">
          <a
            class="page-link"
            (click)="goToPreviousPage()"
            aria-label="Anterior"
          >
            <span aria-hidden="true">&laquo;</span>
          </a>
        </li>
        <li class="page-item active">
          <span class="page-link">{{ currentPage }}</span>
        </li>
        <li class="page-item" [class.disabled]="currentPage === totalPages">
          <a class="page-link" (click)="goToNextPage()" aria-label="Próxima">
            <span aria-hidden="true">&raquo;</span>
          </a>
        </li>
        <li class="page-item" [class.disabled]="currentPage === totalPages">
          <a
            class="page-link"
            (click)="goToPage(totalPages)"
            aria-label="Última"
          >
            <span aria-hidden="true">&raquo;&raquo;</span>
          </a>
        </li>
      </ul>
    </nav>
  </div>
</div>
