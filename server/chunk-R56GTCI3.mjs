import './polyfills.server.mjs';
import{a as fe,b as P,e as ue,f as be,g as _e,h as he}from"./chunk-Y2MQ642V.mjs";import{i as E,j as pe}from"./chunk-H62SANPH.mjs";import{c as de}from"./chunk-DNXLFQ73.mjs";import"./chunk-GQ5VW6DQ.mjs";import{A as me,c as te,e as ie,g as oe,h as ne,j as M,l as ae,p as re,r as le,v as se,y as ce}from"./chunk-HKPF4WWF.mjs";import"./chunk-E6GKQ2BG.mjs";import{c as J,d as K}from"./chunk-23X2HCAU.mjs";import{a as ee}from"./chunk-ASEWUHNV.mjs";import"./chunk-55IKNV4Z.mjs";import"./chunk-HV42ZY6N.mjs";import"./chunk-YG54OGXN.mjs";import"./chunk-U7GKTG2D.mjs";import{a as Q,b as X}from"./chunk-VOE2BQPC.mjs";import{a as Y,b as Z}from"./chunk-ABCNLK2Q.mjs";import"./chunk-5EAGQFV4.mjs";import{c as H,e as W,h as L}from"./chunk-DMMZOU22.mjs";import{b as z}from"./chunk-EVPDCH5S.mjs";import{Ib as l,Jb as r,Kb as v,Ob as A,Rb as h,Tb as f,ac as T,bc as s,ca as D,cc as R,da as V,db as p,dc as I,eb as C,ed as N,ha as g,ic as q,id as U,jc as k,jd as G,na as w,oa as j,uc as B,ud as $,wa as u,wb as F,xa as b,yb as _}from"./chunk-6ZJAAIVQ.mjs";import{a as y}from"./chunk-VVCT4QZE.mjs";var ge=(()=>{let i=class i{constructor(){}ngOnInit(){}};i.\u0275fac=function(e){return new(e||i)},i.\u0275cmp=w({type:i,selectors:[["app-diario-oficial-administrativo-index"]],standalone:!0,features:[k],decls:1,vars:0,template:function(e,a){e&1&&v(0,"router-outlet")},dependencies:[L,H]});let o=i;return o})();var S=class{static toSubmit(i){console.log(i);let n=new FormData,t=y({},i);return n.append("date",t.date),n.append("description",t.description),t.files&&t.files.length>0?t.files.forEach(e=>{n.append("files[]",e)}):console.error("Nenhum arquivo foi selecionado."),n}};var ve=(()=>{let i=class i{constructor(t,e){this._http=t,this._tenantService=e}publicarDiarioOficial(t){return this._http.post(`${Y.API_URL}/tenants/${this._tenantService.getTenant()}/diario-oficial/official-gazettes`,t)}};i.\u0275fac=function(e){return new(e||i)(g(z),g(Z))},i.\u0275prov=D({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})();var xe=(()=>{let i=class i{constructor(t,e,a,d){this._repository=t,this._router=e,this._toastr=a,this._location=d}goBack(){this._location.back()}publicarDiarioOficial(t){this._repository.publicarDiarioOficial(t).subscribe({next:e=>{this._toastr.success(e.message||"Publica\xE7\xE3o realizada com sucesso!","Sucesso"),this.goBack()},error:e=>{let a=e?.error?.message||"Ocorreu um erro!";this._toastr.error(a,"Erro")}})}};i.\u0275fac=function(e){return new(e||i)(g(ve),g(W),g(ee),g(N))},i.\u0275prov=D({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})();function we(o,i){if(o&1&&(l(0,"p"),s(1),r()),o&2){let n,t=f(2);p(),I(" ",(n=t.formAgendado.get("files"))==null?null:n.value.name," ")}}function Ae(o,i){if(o&1){let n=A();l(0,"tr")(1,"td",27),s(2),r(),l(3,"td")(4,"div",28)(5,"div",29)(6,"a",30),h("click",function(){let e=u(n).$implicit,a=f(4);return b(a.viewFile(e))}),l(7,"mat-icon"),s(8,"visibility"),r()()(),l(9,"div",29)(10,"button",31),h("click",function(){let e=u(n).index,a=f(4);return b(a.removeFile(e))}),v(11,"img",32),r()()()()()}if(o&2){let n=i.$implicit;p(2),R(n.name)}}function ke(o,i){if(o&1&&(l(0,"table",25)(1,"thead")(2,"tr")(3,"th"),s(4,"Arquivos Anexados"),r(),l(5,"th"),s(6,"A\xE7\xF5es"),r()()(),l(7,"tbody"),F(8,Ae,12,1,"tr",26),r()()),o&2){let n=f(3);p(8),_("ngForOf",n.selectedFiles)}}function Me(o,i){if(o&1&&(l(0,"div",22)(1,"p",23),s(2),v(3,"br"),s(4," Tipos de arquivo aceitos: "),l(5,"strong"),s(6,".PDF"),r()(),F(7,ke,9,1,"table",24),r()),o&2){let n=f(2);p(2),I(" ",n.nameFile||"Nenhum arquivo selecionado"," "),p(5),_("ngIf",n.selectedFiles.length>0)}}function Ee(o,i){if(o&1){let n=A();l(0,"div",4)(1,"h4",5),s(2,"Agendar Publica\xE7\xE3o"),r(),l(3,"button",6),h("click",function(){u(n);let e=f();return b(e.modalRef==null?null:e.modalRef.hide())}),l(4,"span",7),s(5,"\xD7"),r()()(),l(6,"div",8)(7,"form",9),h("ngSubmit",function(){u(n);let e=f();return b(e.onSubmitAgendado())}),l(8,"div",10)(9,"label",11),s(10,"Data Agendada"),r(),v(11,"input",12),r(),l(12,"div",10)(13,"label",13),s(14,"Arquivo"),r(),l(15,"input",14),h("change",function(e){u(n);let a=f();return b(a.onFileChangeAgendado(e,"file"))}),r(),F(16,we,2,1,"p",15),r(),l(17,"div",10)(18,"label",16),s(19,"Descri\xE7\xE3o"),r(),v(20,"textarea",17),r(),l(21,"div",18)(22,"button",19),s(23," Confirmar Agendamento "),r(),l(24,"button",20),h("click",function(){u(n);let e=f();return b(e.closeModal())}),s(25," Cancelar "),r()()(),F(26,Me,8,2,"div",21),r()}if(o&2){let n,t=f();p(7),_("formGroup",t.formAgendado),p(4),_("minDate",t.minDate)("bsConfig",t.bsConfig),p(5),_("ngIf",(n=t.formAgendado.get("files"))==null?null:n.value),p(6),_("disabled",!t.formAgendado.valid),p(4),_("ngIf",t.selectedFiles.length>0)}}fe("pt-br",P);var Fe=(()=>{let i=class i{constructor(t,e,a,d){this._localeService=t,this.fb=e,this._modalService=a,this._publicarService=d,this.filtroForm=this.fb.group({}),this.formAgendado=this.fb.group({files:new M(""),date:new M(""),description:new M("")}),this.nameFile=null,this.selectedFiles=[],this.selectedFilesMap={},this.minDate=new Date,this.bsConfig=Object.assign({},{containerClass:"theme-default"}),this.dynamicFields=[{name:"date",type:"date",label:"Data",required:!0,value:new Date,disabled:!0},{name:"description",type:"textarea",label:"Descri\xE7\xE3o",required:!0},{name:"files",type:"file",fileType:"complex",label:"Arquivo",required:!0}],t.use("pt-br"),this.dynamicFields.forEach(c=>{let m=c.required?[ie.required]:[];c.type==="file"?this.filtroForm.addControl(c.name,this.fb.control(null,m)):c.type==="checkbox"?this.filtroForm.addControl(c.name,this.fb.control(!1,m)):c.type==="date"?this.filtroForm.addControl(c.name,this.fb.control({value:new Date,disabled:!0},m)):this.filtroForm.addControl(c.name,this.fb.control("teste",m))})}ngOnInit(){}onFormSubmit(t){let e=S.toSubmit(t);this._publicarService.publicarDiarioOficial(e)}onSubmitAgendado(){if(this.formAgendado.valid){let t=y({},this.formAgendado.getRawValue());Object.keys(t).forEach(e=>{this.formAgendado.get(e)?.value instanceof Date&&(t[e]=this.formAgendado.get(e)?.value.toISOString())}),this._publicarService.publicarDiarioOficial(S.toSubmit(t))}}onFileChangeAgendado(t,e){let a=t.target.files,d=[],c=[];if(this.selectedFilesMap||(this.selectedFilesMap={}),this.selectedFilesMap[e]||(this.selectedFilesMap[e]=[]),a&&a.length>0){for(let m=0;m<a.length;m++){let x=a[m];x.type==="application/pdf"&&!this.selectedFilesMap[e].some(Ce=>Ce.name===x.name)?d.push(x):(x.type,c.push(x.name))}d.length>0&&(this.selectedFilesMap[e].push(...d),this.selectedFiles=this.selectedFilesMap[e],this.nameFile=this.selectedFiles.map(m=>m.name).join(", "),this.formAgendado.controls.files.setValue(this.selectedFiles),this.formAgendado.get(e)?.updateValueAndValidity()),c.length>0&&alert(`Os seguintes arquivos n\xE3o s\xE3o PDFs ou est\xE3o duplicados: ${c.join(", ")}`)}}viewFile(t){let e=URL.createObjectURL(t),a=window.open(e,"_blank");if(a){let d=setInterval(()=>{a.closed&&clearInterval(d)},500)}}removeFile(t){this.selectedFiles.splice(t,1),this.selectedFiles.length===0&&(this.nameFile=null)}openModal(t){this.modalRef=this._modalService.show(t,Object.assign({},{class:"modal-lg"}))}closeModal(){this.modalRef&&(this.modalRef.hide(),this.modalRef=void 0)}};i.\u0275fac=function(e){return new(e||i)(C(ue),C(ce),C(E),C(xe))},i.\u0275cmp=w({type:i,selectors:[["app-publicar-diario-oficial-administrativo"]],standalone:!0,features:[q([E]),k],decls:6,vars:3,consts:[["template",""],[1,"bkg-administrativo"],["app-formulario","",3,"formSubmit","titulo_pagina","dynamicFields","form"],[1,"btn","btn-dark","btn-agendar",3,"click"],[1,"modal-header"],[1,"modal-title","pull-left"],["type","button","aria-label","Close",1,"btn-close","close","pull-right",3,"click"],["aria-hidden","true",1,"visually-hidden"],[1,"modal-body"],[3,"ngSubmit","formGroup"],[1,"mb-3"],["for","dataAgendada"],["type","text","placeholder","Data","formControlName","date","bsDatepicker","",1,"form-control",3,"minDate","bsConfig"],["for","fileUpload2"],["type","file","id","fileUpload2","accept",".pdf","formControlName","files",1,"form-control",3,"change"],[4,"ngIf"],["for","description"],["id","description","formControlName","description","required","",1,"form-control"],[1,"d-flex","justify-content-center","align-items-center","flex-column","gap-2","w-100","mt-3"],["type","submit","data-bs-dismiss","modal",1,"btn","btn-lg","btn-dark","w-100",3,"disabled"],["type","button","data-bs-dismiss","modal",1,"btn","btn-lg","btn-outline-dark","w-100",3,"click"],["class","upload-content",4,"ngIf"],[1,"upload-content"],[1,"file-upload-instructions"],["class","table table-bordered table-sm mt-5",4,"ngIf"],[1,"table","table-bordered","table-sm","mt-5"],[4,"ngFor","ngForOf"],[1,"p-3"],[1,"row"],[1,"col"],["mat-icon-button","","color","accent",3,"click"],[1,"btn-format","btn-format","btn-remove","mt-2",3,"click"],["src","../../../../../assets/icons/remove-icon.svg","alt","Remover"]],template:function(e,a){if(e&1){let d=A();l(0,"div",1)(1,"app-layout-forms-adm",2),h("formSubmit",function(m){return u(d),b(a.onFormSubmit(m))}),r(),l(2,"button",3),h("click",function(){u(d);let m=T(5);return b(a.openModal(m))}),s(3," Agendar publica\xE7\xE3o"),r()(),F(4,Ee,27,6,"ng-template",null,0,B)}e&2&&(p(),_("titulo_pagina","Publicar no di\xE1rio oficial")("dynamicFields",a.dynamicFields)("form",a.filtroForm))},dependencies:[$,U,G,me,ae,te,oe,ne,se,re,le,pe,X,Q,K,J,he,be,_e,de],styles:[".bkg-administrativo[_ngcontent-%COMP%]{position:relative}.bkg-administrativo[_ngcontent-%COMP%]   .btn-agendar[_ngcontent-%COMP%]{position:absolute;bottom:94px;right:44px}.btn-dark[_ngcontent-%COMP%]:hover{background-color:#057a0b}  .mat-mdc-form-field .mdc-text-field__input{text-align:center!important;color:#000!important}"]});let o=i;return o})();var Oe=[{path:"",component:ge,children:[{path:"",redirectTo:"gerenciar",pathMatch:"full"},{path:"publicar",component:Fe}]}],ii=(()=>{let i=class i{};i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=j({type:i}),i.\u0275inj=V({imports:[L.forChild(Oe),L]});let o=i;return o})();export{ii as DiarioOficialAdministrativoRoutingModule};
